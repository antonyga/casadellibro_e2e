<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" type="image/svg+xml" href="favicon.svg" />
  <title>TestPilot â€” Dashboard</title>
  <link rel="stylesheet" href="css/styles.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>

<!-- â”€â”€ Sidebar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<aside class="sidebar">
  <div class="sidebar-logo">
    <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
      <path d="M9 3H5a2 2 0 00-2 2v4m6-6h10a2 2 0 012 2v4M9 3v18m0 0h10a2 2 0 002-2V9M9 21H5a2 2 0 01-2-2V9m0 0h18"/>
    </svg>
    <span class="logo-text">TestPilot</span>
    <span class="logo-badge">BETA</span>
  </div>
  <nav class="sidebar-nav">
    <span class="nav-section-label">Overview</span>
    <a href="index.html" class="nav-item active">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>
      <span>Dashboard</span>
    </a>
    <a href="tests.html" class="nav-item">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.5 3H9.5L9 7.5c0 .5-.5 1-1 1H4a1 1 0 00-1 1V21a1 1 0 001 1h16a1 1 0 001-1V9.5a1 1 0 00-1-1h-4c-.5 0-1-.5-1-1L14.5 3z"/><line x1="12" y1="12" x2="12" y2="16"/><line x1="10" y1="14" x2="14" y2="14"/></svg>
      <span>Test Suites</span>
      <span class="nav-badge" id="navFailedBadge" style="display:none"></span>
    </a>
    <span class="nav-section-label">Tools</span>
    <a href="codegen.html" class="nav-item">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3l1.88 5.76a1 1 0 00.95.69H21l-4.94 3.6a1 1 0 00-.36 1.12L17.58 20 12 16.24 6.42 20l1.88-5.83a1 1 0 00-.36-1.12L3 9.45h6.17a1 1 0 00.95-.69L12 3z"/></svg>
      <span>AI Generator</span>
    </a>
    <a href="visual.html" class="nav-item">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
      <span>Visual Tests</span>
    </a>
    <span class="nav-section-label">Config</span>
    <a href="settings.html" class="nav-item">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-4 0v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83-2.83l.06-.06A1.65 1.65 0 004.68 15a1.65 1.65 0 00-1.51-1H3a2 2 0 010-4h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 012.83-2.83l.06.06A1.65 1.65 0 009 4.68a1.65 1.65 0 001-1.51V3a2 2 0 014 0v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 2.83l-.06.06A1.65 1.65 0 0019.4 9a1.65 1.65 0 001.51 1H21a2 2 0 010 4h-.09a1.65 1.65 0 00-1.51 1z"/></svg>
      <span>Settings</span>
    </a>
  </nav>
  <div class="sidebar-footer">
    <div class="user-profile">
      <div class="avatar">QA</div>
      <div class="user-info">
        <span class="user-name">QA Engineer</span>
        <span class="user-role">casadellibro.com</span>
      </div>
    </div>
  </div>
</aside>

<!-- â”€â”€ Main Layout â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="main-layout">
  <header class="topbar">
    <div class="topbar-left">
      <h1 class="page-title">Dashboard</h1>
    </div>
    <div class="topbar-right">
      <div class="env-selector">
        <select id="envSelect">
          <option value="prod">ðŸŸ¢  Production</option>
          <option value="stage">ðŸŸ¡  Staging</option>
          <option value="dev">ðŸ”µ  Pre-prod</option>
        </select>
      </div>
      <button class="icon-btn" title="Refresh dashboard" onclick="loadDashboard()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 4 23 10 17 10"/><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/></svg>
      </button>
    </div>
  </header>

  <main class="content">

    <!-- Stat Cards -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-info">
          <span class="stat-label">Total Tests</span>
          <span class="stat-value" id="statTotal">â€”</span>
          <span class="stat-delta neutral" id="statTotalDelta">Loadingâ€¦</span>
        </div>
        <div class="stat-icon indigo">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.5 3H9.5L9 7.5c0 .5-.5 1-1 1H4a1 1 0 00-1 1V21a1 1 0 001 1h16a1 1 0 001-1V9.5a1 1 0 00-1-1h-4c-.5 0-1-.5-1-1L14.5 3z"/></svg>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-info">
          <span class="stat-label">Passed</span>
          <span class="stat-value" style="color:var(--success)" id="statPassed">â€”</span>
          <span class="stat-delta neutral" id="statPassedDelta">Loadingâ€¦</span>
        </div>
        <div class="stat-icon green">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><polyline points="20 6 9 17 4 12"/></svg>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-info">
          <span class="stat-label">Failed</span>
          <span class="stat-value" style="color:var(--error)" id="statFailed">â€”</span>
          <span class="stat-delta neutral" id="statFailedDelta">Loadingâ€¦</span>
        </div>
        <div class="stat-icon red">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-info">
          <span class="stat-label">Total Runs</span>
          <span class="stat-value" id="statRuns">â€”</span>
          <span class="stat-delta neutral" id="statRunsDelta">Loadingâ€¦</span>
        </div>
        <div class="stat-icon yellow">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><polygon points="5 3 19 12 5 21 5 3"/></svg>
        </div>
      </div>
    </div>

    <!-- Chart Row -->
    <div class="chart-row">
      <!-- Donut Chart -->
      <div class="card">
        <div class="card-title">
          Latest Run Results
          <span class="card-title-action" onclick="loadDashboard()" style="cursor:pointer">Refresh â†»</span>
        </div>
        <div class="chart-container">
          <canvas id="resultsChart"></canvas>
        </div>
        <div class="chart-legend">
          <div class="legend-item">
            <div class="legend-dot-label"><div class="legend-dot" style="background:var(--success)"></div><span>Passed</span></div>
            <span><span class="legend-value" id="legendPassedVal">â€”</span><span class="legend-pct" id="legendPassedPct"></span></span>
          </div>
          <div class="legend-item">
            <div class="legend-dot-label"><div class="legend-dot" style="background:var(--error)"></div><span>Failed</span></div>
            <span><span class="legend-value" id="legendFailedVal">â€”</span><span class="legend-pct" id="legendFailedPct"></span></span>
          </div>
        </div>
      </div>

      <!-- Pass Rate / Flakiness Widget -->
      <div class="card">
        <div class="card-title">
          Pass Rate by Test
          <a href="tests.html" class="card-title-action">Run tests â†’</a>
        </div>
        <div id="flakinessContainer">
          <div style="color:var(--text-secondary);font-size:0.82rem;padding:12px 0">Loadingâ€¦</div>
        </div>
        <div class="divider"></div>
        <div style="display:flex;align-items:center;gap:8px;font-size:0.78rem;color:var(--text-secondary)">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
          Pass rate across all recorded runs
        </div>
      </div>
    </div>

    <!-- Recent Test Runs -->
    <div class="card">
      <div class="card-title">
        Recent Runs
        <a href="tests.html" class="card-title-action">Run tests â†’</a>
      </div>
      <div class="table-wrapper">
        <table>
          <thead>
            <tr>
              <th>Test Name</th>
              <th>Suite</th>
              <th>Status</th>
              <th>Browser</th>
              <th>Duration</th>
              <th>Run At</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="recentRunsBody">
            <tr><td colspan="7" style="text-align:center;color:var(--text-secondary);padding:24px">Loadingâ€¦</td></tr>
          </tbody>
        </table>
      </div>
    </div>

  </main>
</div>

<script>
// â”€â”€ Data loading â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let resultsChart = null;

async function loadDashboard() {
  let reports = [], tests = [];
  try {
    [reports, tests] = await Promise.all([
      fetch('/api/reports').then(r => r.json()),
      fetch('/api/tests').then(r => r.json()),
    ]);
  } catch {
    showServerError();
    return;
  }

  const latest = reports[0] || null;
  const prev   = reports[1] || null;

  // â”€â”€ Counts from latest run â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const latestPassed = latest ? latest.results.filter(r => r.passed).length : 0;
  const latestFailed = latest ? latest.results.filter(r => !r.passed).length : 0;
  const prevPassed   = prev   ? prev.results.filter(r => r.passed).length   : null;
  const prevFailed   = prev   ? prev.results.filter(r => !r.passed).length  : null;

  // â”€â”€ Per-test pass rate across all runs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const testMap = {};
  tests.forEach(t => {
    testMap[t.id] = { label: t.label, specFile: t.specFile, runs: 0, passed: 0 };
  });
  reports.forEach(report => {
    (report.results || []).forEach(r => {
      if (testMap[r.id]) {
        testMap[r.id].runs++;
        if (r.passed) testMap[r.id].passed++;
      }
    });
  });

  // â”€â”€ Stat cards â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  setText('statTotal',  tests.length);
  setText('statPassed', latest ? latestPassed : 'â€”');
  setText('statFailed', latest ? latestFailed : 'â€”');
  setText('statRuns',   reports.length);

  setDelta('statTotalDelta',  null, reports.length === 0 ? 'No runs yet' : `${tests.length} spec${tests.length !== 1 ? 's' : ''} defined`);
  setDelta('statPassedDelta', prevPassed !== null ? latestPassed - prevPassed : null,
    latest ? null : 'No runs yet', true);
  setDelta('statFailedDelta', prevFailed !== null ? latestFailed - prevFailed : null,
    latest ? null : 'No runs yet', false);
  setDelta('statRunsDelta',   null,
    reports.length === 0 ? 'No runs yet' : `Last: ${fmtTime(latest.timestamp)}`);

  // Update sidebar failed badge
  const badge = document.getElementById('navFailedBadge');
  if (latest && latestFailed > 0) {
    badge.textContent = latestFailed + ' failed';
    badge.style.display = '';
    badge.style.background = 'var(--error)';
    badge.style.color = '#fff';
  } else {
    badge.style.display = 'none';
  }

  // â”€â”€ Donut chart â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  renderChart(latestPassed, latestFailed);

  const total = (latestPassed + latestFailed) || 1;
  setText('legendPassedVal', latest ? latestPassed : 'â€”');
  setText('legendFailedVal', latest ? latestFailed : 'â€”');
  document.getElementById('legendPassedPct').textContent = latest ? Math.round(latestPassed / total * 100) + '%' : '';
  document.getElementById('legendFailedPct').textContent = latest ? Math.round(latestFailed / total * 100) + '%' : '';

  // â”€â”€ Pass rate / flakiness widget â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  renderFlakiness(testMap, reports.length);

  // â”€â”€ Recent runs table â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  renderRecentRuns(reports);
}

// â”€â”€ Chart â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderChart(passed, failed) {
  const ctx  = document.getElementById('resultsChart').getContext('2d');
  const data = (passed + failed) > 0
    ? [passed, failed]
    : [1];  // placeholder slice when no data
  const colors = (passed + failed) > 0
    ? ['#10B981', '#EF4444']
    : ['#e2e8f0'];

  if (resultsChart) {
    resultsChart.data.datasets[0].data           = data;
    resultsChart.data.datasets[0].backgroundColor = colors;
    resultsChart.update();
    return;
  }

  resultsChart = new Chart(ctx, {
    type: 'doughnut',
    data: {
      labels: ['Passed', 'Failed'],
      datasets: [{
        data,
        backgroundColor: colors,
        borderWidth:  0,
        spacing:      3,
        borderRadius: 4,
      }]
    },
    options: {
      cutout: '70%',
      plugins: {
        legend: { display: false },
        tooltip: { callbacks: { label: c => ` ${c.label}: ${c.parsed} tests` } }
      },
      animation: { animateRotate: true, duration: 900, easing: 'easeOutQuart' }
    }
  });
}

// â”€â”€ Pass rate bars â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderFlakiness(testMap, totalReports) {
  const container = document.getElementById('flakinessContainer');
  const items     = Object.values(testMap).sort((a, b) => {
    const rA = a.runs ? a.passed / a.runs : 1;
    const rB = b.runs ? b.passed / b.runs : 1;
    return rA - rB;   // worst first
  });

  if (totalReports === 0) {
    container.innerHTML = '<div style="color:var(--text-secondary);font-size:0.82rem;padding:12px 0">No runs yet â€” go to <a href="tests.html" style="color:var(--accent)">Test Suites</a> to run your first test.</div>';
    return;
  }

  container.innerHTML = items.map(t => {
    const pct    = t.runs ? Math.round(t.passed / t.runs * 100) : 0;
    const color  = pct === 100 ? 'var(--success)' : pct >= 50 ? 'var(--warning)' : 'var(--error)';
    const runsLbl = t.runs ? `${t.passed}/${t.runs} runs` : 'not run yet';
    return `
      <div class="flakiness-item">
        <div class="flakiness-name">
          <div class="test-name">${esc(t.label)}</div>
          <div class="suite-name">${esc(t.specFile || '')} Â· ${runsLbl}</div>
        </div>
        <div class="flakiness-bar-wrap">
          <div class="flakiness-bar">
            <div class="flakiness-bar-fill" style="width:${t.runs ? pct : 0}%;background:${color}"></div>
          </div>
        </div>
        <span class="flakiness-pct" style="color:${color}">${t.runs ? pct + '%' : 'â€”'}</span>
      </div>`;
  }).join('');

  // Animate bars
  requestAnimationFrame(() => {
    container.querySelectorAll('.flakiness-bar-fill').forEach(el => {
      const w = el.style.width;
      el.style.width = '0';
      setTimeout(() => el.style.width = w, 80);
    });
  });
}

// â”€â”€ Recent runs table â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderRecentRuns(reports) {
  const tbody = document.getElementById('recentRunsBody');

  if (reports.length === 0) {
    tbody.innerHTML = `<tr><td colspan="7" style="text-align:center;color:var(--text-secondary);padding:32px">
      No runs recorded yet. <a href="tests.html" style="color:var(--accent)">Run your first test â†’</a>
    </td></tr>`;
    return;
  }

  // Expand each report into individual test rows (newest first, max 20 rows)
  const rows = [];
  for (const report of reports) {
    for (const r of (report.results || [])) {
      rows.push({ report, result: r });
      if (rows.length >= 20) break;
    }
    if (rows.length >= 20) break;
  }

  tbody.innerHTML = rows.map(({ report, result }) => {
    const badge  = result.passed
      ? `<span class="badge badge-passed"><span class="badge-dot"></span>Passed</span>`
      : `<span class="badge badge-failed"><span class="badge-dot"></span>Failed</span>`;
    const label    = esc(result.label ?? `Test #${result.id}`);
    const specFile = esc(specFileFor(result.id));
    const dur      = esc(result.duration ?? 'â€”');
    const runAt    = fmtTime(report.timestamp);
    const reportUrl = report.hasHtml
      ? `/reports/${report.id}/html/index.html`
      : '#';
    const actionBtn = report.hasHtml
      ? `<a href="${reportUrl}" target="_blank" class="btn btn-ghost btn-sm">Report</a>`
      : `<span style="color:var(--text-secondary);font-size:0.78rem">No report</span>`;

    return `<tr>
      <td class="td-label">${label}</td>
      <td class="td-secondary">${specFile}</td>
      <td>${badge}</td>
      <td class="td-secondary">Chromium</td>
      <td class="td-mono">${dur}</td>
      <td class="td-secondary">${runAt}</td>
      <td>${actionBtn}</td>
    </tr>`;
  }).join('');
}

// â”€â”€ Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const SPEC_MAP = {};  // filled after /api/tests loads
function specFileFor(id) {
  return SPEC_MAP[id] || '';
}

function setText(id, val) {
  const el = document.getElementById(id);
  if (el) el.textContent = val;
}

function setDelta(id, delta, fallback, higherIsBetter = true) {
  const el = document.getElementById(id);
  if (!el) return;
  if (delta === null || delta === undefined) {
    el.textContent = fallback ?? '';
    el.className   = 'stat-delta neutral';
    return;
  }
  const sign = delta > 0 ? '+' : '';
  el.textContent = delta === 0 ? 'Same as last run' : `${sign}${delta} from last run`;
  const up = delta > 0 ? higherIsBetter : !higherIsBetter;
  el.className = `stat-delta ${delta === 0 ? 'neutral' : up ? 'up' : 'down'}`;
}

function fmtTime(iso) {
  if (!iso) return 'â€”';
  const d = new Date(iso);
  const pad = n => String(n).padStart(2, '0');
  return `${pad(d.getDate())}/${pad(d.getMonth()+1)} ${pad(d.getHours())}:${pad(d.getMinutes())}`;
}

function esc(str) {
  return String(str ?? '')
    .replace(/&/g, '&amp;')
    .replace(/</g, '&lt;')
    .replace(/>/g, '&gt;');
}

function showServerError() {
  ['statTotal','statPassed','statFailed','statRuns'].forEach(id => setText(id, 'â€”'));
  ['statTotalDelta','statPassedDelta','statFailedDelta','statRunsDelta'].forEach(id => {
    const el = document.getElementById(id);
    if (el) { el.textContent = 'Server offline'; el.className = 'stat-delta down'; }
  });
  document.getElementById('recentRunsBody').innerHTML =
    `<tr><td colspan="7" style="text-align:center;color:var(--error);padding:32px">
      Could not reach the TestPilot server. Make sure it is running: <code>npm run ui</code>
    </td></tr>`;
  document.getElementById('flakinessContainer').innerHTML =
    `<div style="color:var(--error);font-size:0.82rem;padding:12px 0">Server offline</div>`;
}



// â”€â”€ Boot â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.addEventListener('DOMContentLoaded', async () => {
  // Pre-load spec file names so renderRecentRuns can use them
  try {
    const tests = await fetch('/api/tests').then(r => r.json());
    tests.forEach(t => { SPEC_MAP[t.id] = t.specFile?.split('/').pop() ?? ''; });
  } catch { /* ignore, SPEC_MAP stays empty */ }

  loadDashboard();
});
</script>
</body>
</html>
